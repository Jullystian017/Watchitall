<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Watchlist Saya</title>
  <link rel="stylesheet" href="/css/watchlist.css">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <script type="module">
  import { auth, db } from '../js/firebase-init.js';
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = 'login.html';
    return;
  }
  const docSnap = await getDoc(doc(db, "users", user.email));
  if (!docSnap.exists() || !docSnap.data().isPaid) {
    window.location.href = 'payment.html';
  }
  
});
  
</script>
</head>
<body>
  <header>
        <div class="Logo">
            <img src="../assets/image/logo.png" alt="" class="Logo">
        </div>
        <input type="checkbox" id="nav_check" hidden>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="tv-show.html">TV Show</a></li>
                <li><a href="movies.html">Movies</a></li>
                <li><a href="release.html">Release</a></li>
                <div class="nav-indicator"></div> 
            </ul>
        </nav>
        <div class="icon">
    <div class="search-container">
        <i class='bx bx-search search-icon'></i>
        <input type="text" class="search-input" placeholder="search movies">
        <div class="search-results" id="searchResults"></div>
    </div>

    <div class="user-container">
        <i class='bx bx-user' id="userIcon"></i>
        <div class="user-dashboard" id="userDashboard">
          <ul>
            <li id="account" class="active"><a href="account.html">Account</a></li>
            <li id="watchlistItem"><a href="watchlist.html">Watchlist</a></li>
            <li id="historyItem"><a href="history.html">Watch History</a></li>
            <li><a href="#" id="logout-btn">Logout</a></li>
          </ul>
        </div>
      </div>

<script type="module">
  import { auth } from '../js/firebase-init.js';
  import { signOut } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";

  document.getElementById("logout-btn").addEventListener("click", async (e) => {
    e.preventDefault();
    try {
      await signOut(auth);

      // Bersihkan localStorage
      localStorage.removeItem("loggedInUser");
      localStorage.removeItem("email");

      // Tampilkan notifikasi logout
      alert("Anda telah logout dari akun Anda.");

      // Redirect ke unpaid.html
      window.location.href = "unpaid.html";
    } catch (error) {
      alert("Gagal logout: " + error.message);
    }
  });
</script>

<div class="menu-toggle" id="menuToggle">
        <i class='bx bx-menu'></i>
    </div>
    </header>

  <main class="watchlist-page">
    <div class="watchlist-header">
      <h2>My Watchlist</h2>
      <button id="deleteAllBtn" class="delete-all-btn">
        <i class='bx bx-trash'></i> Delete All
      </button>
    </div>
    
    <div class="empty-state" id="emptyState">
      <i class='bx bx-movie-play'></i>
      <h3>Your watchlist is empty</h3>
      <p>Add movies and TV shows to your watchlist to keep track of what you want to watch.</p>
      <a href="movies.html" class="browse-btn">Browse Movies</a>
    </div>
    
    <div class="movie-grid" id="movieGrid">
      <!-- Movie cards will be dynamically added here -->
    </div>
  </main>
  
  <!-- Confirmation Modal -->
  <div class="modal" id="confirmationModal">
    <div class="modal-content">
      <h3>Delete All Items?</h3>
      <p>Are you sure you want to remove all items from your watchlist?</p>
      <div class="modal-buttons">
        <button id="confirmDeleteAll" class="confirm-btn">Delete All</button>
        <button id="cancelDeleteAll" class="cancel-btn">Cancel</button>
      </div>
    </div>
  </div>
</body>
</html>

<style>
   @import url('https://fonts.googleapis.com/css2?family=Judson:ital@1&family=Manrope:wght@200..800&display=swap');

*{
    padding: 0;
    margin: 0;
    box-sizing: border-box;
    list-style: none;
    text-decoration: none;
    font-family: "Manrope", sans-serif;
}
body{
    background: #0f0f0f;
    color: white;
    overflow-x: hidden;
}
img{
    width: 100%;
}

/* NAV */
header{
    width: 90%;
    height: 70%;
    background: transparent;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 0;
    border-radius: 0 0 10px 10px;
    margin: 0 auto;
    backdrop-filter: blur(2px); 
    position: relative;
    z-index: 10;
    animation: fadeIn 0.8s ease-in-out;
}

.Logo {
  padding-top: 8px;
  width: 150px;
  height: auto;
}

nav ul{
    display: flex;
    background: transparent;
    position: relative;
}

nav ul li a{
    color: #BFBFBF;
    display: block;
    margin: 5px 8px;
    padding: 12px 18px;
    transition: 0.2s;
    border-radius: 8px;
    position: relative;
    z-index: 1;
    transition: all 0.3s ease;
}

nav ul li a:hover{
    color: white;
    text-shadow: 0 0 10px #EFB036;
}

nav ul li a.active {
    color: #EFB036;
    font-weight: 900;
    text-shadow: 0 0 10px #EFB036;
    padding: 12px 18px; 
}

i{
    color: white;
}

.icon i{
    font-size: 24px;
    padding-left: 20px;
    transition: transform 0.3s ease;
}

.icon i:hover {
    transform: scale(1.2);
    color: #EFB036;
}

.nav-indicator {
    position: absolute;
    height: 100%;
    background-color: #EFB036;
    border-radius: 8px;
    z-index: 0;
    top: 0;
    left: 0;
    width: 0;
    transition: all 0.3s ease;
}

/* Search Styles */
.search-container {
    position: relative;
    display: inline-block;
}

.search-icon {
    font-size: 24px;
    padding-left: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    z-index: 2;
}

.search-icon.active {
    color: #EFB036;
}

.search-input {
    position: absolute;
    top: 50%;
    right: 0;
    transform: translateY(-50%);
    width: 0;
    padding: 0;
    border: none;
    background: transparent;
    color: white;
    font-size: 16px;
    transition: all 0.3s ease;
    opacity: 0;
    pointer-events: none;
    z-index: 1;
    padding-right: 5px;
}

.search-input.active {
    width: 250px;
    padding: 8px 15px 8px 35px;
    background: rgba(0, 0, 0, 0.7);
    border-radius: 20px;
    opacity: 1;
    pointer-events: all;
    right: -10px;
}

.search-results {
    position: absolute;
    top: 100%;
    right: 0;
    width: 300px;
    max-height: 400px;
    overflow-y: auto;
    background: rgba(0, 0, 0, 0.9);
    border-radius: 8px;
    padding: 10px;
    display: none;
    z-index: 1000;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
    margin-top: 5px;
}

.search-results.active {
    display: block;
}

.search-result-item {
    display: flex;
    align-items: center;
    padding: 10px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.search-result-item:hover {
    background-color: rgba(239, 176, 54, 0.2);
}

.search-result-item img {
    width: 50px;
    height: 75px;
    object-fit: cover;
    border-radius: 4px;
    margin-right: 10px;
}

.search-result-info {
    flex: 1;
}

.search-result-info h4 {
    margin: 0;
    font-size: 14px;
    color: white;
}

.search-result-info p {
    margin: 5px 0 0;
    font-size: 12px;
    color: #BFBFBF;
}

.search-result-type {
    display: inline-block;
    padding: 2px 5px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: bold;
    margin-top: 3px;
}

.search-result-type.movie {
    background-color: #EFB036;
    color: black;
}

.search-result-type.tv {
    background-color: #4CAF50;
    color: white;
}

.icon {
    display: flex;
    align-items: center;
    gap: 8px;
}

.search-container {
    display: flex;
    align-items: center;
    position: relative;
}

.search-icon {
    font-size: 20px;
    margin-right: 8px;
    cursor: pointer;
}

.search-input {
    padding: 6px 10px;
    border-radius: 4px;
    border: 1px solid #ccc;
}

.user-container {
      position: relative;
      cursor: pointer;
    }

    .bx-user {
      font-size: 24px;
    }

    .user-dashboard {
      position: absolute;
      top: 30px;
      right: 0;
      background: rgba(30, 30, 30, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      border-radius: 8px;
      display: none;
      padding: 10px;
      width: 180px;
      z-index: 100;
    }

    .user-dashboard ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .user-dashboard ul li {
      margin: 10px 0;
    }

    .user-dashboard ul li a {
      text-decoration: none;
      color: #eee;
      font-weight: 500;
      display: block;
      padding: 6px 8px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .user-dashboard ul li a:hover {
      color: #EFB036;
      background: rgba(239, 176, 54, 0.1);
    }
    
/* Watchlist Page Styles */
.watchlist-page {
  padding: 30px 5%;
  padding-top: 50px;
  min-height: 80vh;
}

.watchlist-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  padding-bottom: 15px;
  border-bottom: 1px solid #2a2a2a;
}

.watchlist-header h2 {
  font-size: 28px;
  color: #ffffff;
  margin: 0;
  font-weight: 700;
}

.delete-all-btn {
  background: rgba(239, 176, 54, 0.1);
  color: #FF4B4B;
  border: 1px solid #FF4B4B;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  transition: all 0.3s ease;
}

.delete-all-btn:hover {
  background: rgba(239, 66, 54, 0.2);
}

.delete-all-btn i {
  font-size: 18px;
  color: #FF4B4B;
}

.empty-state {
  text-align: center;
  padding: 50px 20px;
  display: none;
}

.empty-state i {
  font-size: 60px;
  color: #3a3a3a;
  margin-bottom: 20px;
}

.empty-state h3 {
  font-size: 22px;
  margin-bottom: 10px;
  color: #e0e0e0;
}

.empty-state p {
  color: #8a8a8a;
  margin-bottom: 25px;
  max-width: 400px;
  margin-left: auto;
  margin-right: auto;
}

.browse-btn {
  background: #EFB036;
  color: #000;
  padding: 10px 25px;
  border-radius: 6px;
  font-weight: 600;
  transition: all 0.3s ease;
}

.browse-btn:hover {
  background: #e0a42e;
  transform: translateY(-2px);
}

.movie-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 25px;
}

.movie-card {
  background: #1a1a1a;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
  position: relative;
}

.movie-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.4);
}

.movie-poster {
  width: 100%;
  height: 250px;
  object-fit: cover;
  display: block;
}

.movie-info {
  padding: 15px;
}

.movie-title {
  font-size: 16px;
  font-weight: 600;
  color: #fff;
  margin-bottom: 5px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.movie-details {
  font-size: 13px;
  color: #8a8a8a;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
}

.movie-rating {
  color: #EFB036;
  font-weight: 600;
}

.delete-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(0,0,0,0.7);
  color: white;
  border: none;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 0;
  transition: all 0.3s ease;
}

.movie-card:hover .delete-btn {
  opacity: 1;
}

.delete-btn:hover {
  background: #FF4B4B;
  color: #000;
}

/* Modal Styles */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background: #1a1a1a;
  padding: 30px;
  border-radius: 10px;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 5px 30px rgba(0,0,0,0.5);
}

.modal h3 {
  font-size: 20px;
  margin-bottom: 15px;
  color: #fff;
}

.modal p {
  color: #8a8a8a;
  margin-bottom: 25px;
}

.modal-buttons {
  display: flex;
  gap: 15px;
  justify-content: flex-end;
}

.confirm-btn {
  background: #EFB036;
  color: #000;
  border: none;
  padding: 8px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
}

.confirm-btn:hover {
  background: #e0a42e;
}

.cancel-btn {
  background: #2a2a2a;
  color: #fff;
  border: none;
  padding: 8px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
}

.cancel-btn:hover {
  background: #3a3a3a;
}

/* Responsive */
@media (max-width: 768px) {
  .movie-grid {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  }
  
  .movie-poster {
    height: 220px;
  }
}

@media (max-width: 480px) {
  .movie-grid {
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 15px;
  }
  
  .movie-poster {
    height: 180px;
  }
  
  .movie-info {
    padding: 10px;
  }
  
  .movie-title {
    font-size: 14px;
  }
  
  .movie-details {
    font-size: 12px;
  }
  
  .watchlist-header h2 {
    font-size: 22px;
  }
  
  .delete-all-btn {
    padding: 6px 12px;
    font-size: 12px;
  }
}

/* Hamburger menu (hidden on desktop) */
.menu-toggle {
    display: none;
    font-size: 26px;
    color: white;
    cursor: pointer;
}

/* Responsive styles for nav */
@media (max-width: 768px) {
  .menu-toggle {
    display: block;
  }

  nav {
    width: 100%;
  }

  nav ul {
    position: absolute;
    top: 90px;
    flex-direction: column;
    align-items: center;
    background-color: rgba(0, 0, 0, 0.95);
    width: 100%;
    display: none;
    border-radius: 8px;
    left: 0;
    right: 0;
    z-index: 99;
  }

  nav ul.show {
    display: flex;
  }

  nav ul li a {
    width: 100%;
  }

  .nav-indicator {
    display: none;
  }
}
</style>

<script>
  const apiKey = 'c4d40593b012ddf8fd9bbafe6c7b3a63';
const baseUrl = 'https://api.themoviedb.org/3';
const imgUrl = 'https://image.tmdb.org/t/p/original';
const imgThumb = 'https://image.tmdb.org/t/p/w500';

const urlParams = new URLSearchParams(window.location.search);
const movieId = urlParams.get('id');

// Search Functionality
const searchIcon = document.querySelector('.search-icon');
const searchInput = document.querySelector('.search-input');
const searchResults = document.getElementById('searchResults');
let searchTimeout;

// Toggle search input
searchIcon.addEventListener('click', (e) => {
    e.stopPropagation();
    searchInput.classList.toggle('active');
    searchIcon.classList.toggle('active');
    
    if (searchInput.classList.contains('active')) {
        searchInput.focus();
    } else {
        searchResults.classList.remove('active');
        searchInput.value = '';
    }
});

// Handle Enter key press
searchInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        const query = searchInput.value.trim();
        if (query.length > 0) {
            window.location.href = `search-results.html?q=${encodeURIComponent(query)}`;
        }
    }
});

// Search as you type
searchInput.addEventListener('input', (e) => {
    clearTimeout(searchTimeout);
    const query = e.target.value.trim();
    
    if (query.length >= 2) {
        searchTimeout = setTimeout(() => {
            searchAll(query);
        }, 500);
    } else {
        searchResults.classList.remove('active');
    }
});

// Close search when clicking outside
document.addEventListener('click', (e) => {
    if (!e.target.closest('.search-container')) {
        searchInput.classList.remove('active');
        searchIcon.classList.remove('active');
        searchResults.classList.remove('active');
        searchInput.value = '';
    }
});

// Rest of your existing functions
function searchAll(query) {
    fetch(`${baseUrl}/search/multi?api_key=${apiKey}&query=${encodeURIComponent(query)}&language=en-US&page=1&include_adult=false`)
        .then(res => res.json())
        .then(data => {
            displaySearchResults(data.results);
        })
        .catch(err => {
            console.error('Search error:', err);
        });
}

function displaySearchResults(results) {
    if (!results || results.length === 0) {
        searchResults.innerHTML = '<div class="search-result-item">No results found</div>';
        searchResults.classList.add('active');
        return;
    }

    searchResults.innerHTML = '';
    
    const filteredResults = results.filter(item => 
        !item.adult && (item.poster_path || item.profile_path)
    ).slice(0, 8);
    
    filteredResults.forEach(item => {
        const resultItem = document.createElement('div');
        resultItem.className = 'search-result-item';
        
        let title, type, link, imagePath;
        
        if (item.media_type === 'movie') {
            title = item.title;
            type = 'Movie';
            link = `detail.html?id=${item.id}`;
            imagePath = item.poster_path;
        } else if (item.media_type === 'tv') {
            title = item.name;
            type = 'TV Show';
            link = `tv-detail.html?id=${item.id}`;
            imagePath = item.poster_path;
        } else if (item.media_type === 'person') {
            title = item.name;
            type = 'Person';
            link = '#';
            imagePath = item.profile_path;
        }
        
        resultItem.innerHTML = `
            <a href="${link}" style="display: flex; width: 100%; text-decoration: none; color: inherit;">
                <img src="${imagePath ? imgThumb + imagePath : 'image/no-poster.png'}" alt="${title}">
                <div class="search-result-info">
                    <h4>${title}</h4>
                    <p>${item.release_date ? item.release_date.split('-')[0] : item.first_air_date ? item.first_air_date.split('-')[0] : ''}</p>
                    <span class="search-result-type ${item.media_type === 'tv' ? 'tv' : 'movie'}">${type}</span>
                </div>
            </a>
        `;
        
        searchResults.appendChild(resultItem);
    });
    
    searchResults.classList.add('active');
}

const userIcon = document.getElementById("userIcon");
    const userDashboard = document.getElementById("userDashboard");

    userIcon.addEventListener("click", () => {
        userDashboard.style.display = userDashboard.style.display === "block" ? "none" : "block";
    });

    // Optional: Close dashboard when clicking outside
    window.addEventListener("click", function (e) {
        if (!userIcon.contains(e.target) && !userDashboard.contains(e.target)) {
            userDashboard.style.display = "none";
        }
    });

// Watchlist Functionality
document.addEventListener('DOMContentLoaded', function() {
    // Initialize watchlist from localStorage
    const watchlist = JSON.parse(localStorage.getItem('watchlist')) || [];
    const movieGrid = document.getElementById('movieGrid');
    const emptyState = document.getElementById('emptyState');
    
    // Display watchlist items
    function displayWatchlist() {
        movieGrid.innerHTML = '';
        
        if (watchlist.length === 0) {
            emptyState.style.display = 'block';
            movieGrid.style.display = 'none';
            document.getElementById('deleteAllBtn').style.display = 'none';
        } else {
            emptyState.style.display = 'none';
            movieGrid.style.display = 'grid';
            document.getElementById('deleteAllBtn').style.display = 'flex';
            
            watchlist.forEach((movie, index) => {
                const movieCard = document.createElement('div');
                movieCard.className = 'movie-card';
                movieCard.innerHTML = `
                    <img src="${imgThumb}${movie.poster_path}" alt="${movie.title}" class="movie-poster">
                    <div class="movie-info">
                        <h3 class="movie-title">${movie.title}</h3>
                        <div class="movie-details">
                            <span>${movie.release_date ? movie.release_date.split('-')[0] : ''}</span>
                            <span class="movie-rating">★ ${movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A'}</span>
                        </div>
                    </div>
                    <button class="delete-btn" data-index="${index}">
                        <i class='bx bx-trash'></i>
                    </button>
                `;
                movieGrid.appendChild(movieCard);
            });
        }
    }
    
    // Delete single movie
    movieGrid.addEventListener('click', function(e) {
        if (e.target.closest('.delete-btn')) {
            const index = e.target.closest('.delete-btn').getAttribute('data-index');
            watchlist.splice(index, 1);
            localStorage.setItem('watchlist', JSON.stringify(watchlist));
            displayWatchlist();
        }
    });
    
    // Delete all movies
    const deleteAllBtn = document.getElementById('deleteAllBtn');
    const confirmationModal = document.getElementById('confirmationModal');
    const confirmDeleteAll = document.getElementById('confirmDeleteAll');
    const cancelDeleteAll = document.getElementById('cancelDeleteAll');
    
    deleteAllBtn.addEventListener('click', function() {
        confirmationModal.style.display = 'flex';
    });
    
    confirmDeleteAll.addEventListener('click', function() {
        localStorage.removeItem('watchlist');
        watchlist.length = 0;
        displayWatchlist();
        confirmationModal.style.display = 'none';
    });
    
    cancelDeleteAll.addEventListener('click', function() {
        confirmationModal.style.display = 'none';
    });
    
    // Close modal when clicking outside
    window.addEventListener('click', function(e) {
        if (e.target === confirmationModal) {
            confirmationModal.style.display = 'none';
        }
    });
    
    // Initial display
    displayWatchlist();
    
    // Highlight active tab in user dashboard
    const path = window.location.pathname;
    if (path.includes("watchlist.html")) {
      document.getElementById("watchlistItem").classList.add("active");
    } else if (path.includes("history.html")) {
      document.getElementById("historyItem").classList.add("active");
    } else if (path.includes("download.html")) {
      document.getElementById("downloadItem").classList.add("active");
    }
});

// For demo purposes - add some sample movies if watchlist is empty
// Remove this in production
function addSampleMovies() {
    const watchlist = JSON.parse(localStorage.getItem('watchlist')) || [];
    if (watchlist.length === 0) {
        const sampleMovies = [
            {
                id: 1,
                title: "The Shawshank Redemption",
                poster_path: "/q6y0Go1tsGEsmtFryDOJo3dEmqu.jpg",
                vote_average: 8.7,
                release_date: "1994-09-23"
            },
            {
                id: 2,
                title: "The Godfather",
                poster_path: "/3bhkrj58Vtu7enYsRolD1fZdja1.jpg",
                vote_average: 8.7,
                release_date: "1972-03-14"
            },
            {
                id: 3,
                title: "The Dark Knight",
                poster_path: "/qJ2tW6WMUDux911r6m7haRef0WH.jpg",
                vote_average: 8.5,
                release_date: "2008-07-16"
            }
        ];
        localStorage.setItem('watchlist', JSON.stringify(sampleMovies));
        location.reload();
    }
}

// Uncomment this line to add sample movies (for demo only)
// addSampleMovies();
</script>
<script>
  const menuToggle = document.getElementById("menuToggle");
  const navList = document.querySelector("nav ul");

  menuToggle.addEventListener("click", () => {
    navList.classList.toggle("show");
  });
</script>
